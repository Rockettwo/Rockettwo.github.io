<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hochzeitsbilder Felix und Vanessa</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-image: url('images/Olivenast.png');
            background-size: 100%;
			background-repeat: no-repeat;
            background-position: top;
            color: black;
            text-align: center;
			display: flex;
            flex-direction: column;
            height: 100vh;
        }
        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-top: 50px;
        }
        .button {
			align: center;
			position: absolute;
			top: 15%;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
			font-size: 2em;
        }
        .carousel-container {
            position: fixed;
			bottom: 10px;
            left: 0;
            width: 100%;
            height: 20%;
            background-color: #f3f3f3;
            overflow: hidden;
			
			margin: auto;
        }
        .carousel {
            display: flex;
            height: 100%;
            transition: transform 0.5s ease;
        }
        .carousel img {		
            max-height: 100%;
            max-width: 100%;
            margin: 0 5px;
            object-fit: contain; 
        }
        .button.left {
            left: 0;
        }
        .button.right {
            right: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="button" id="uploadButton">Hochzeitsbilder hochladen</button>
    </div>
    <div class="carousel-container">
        <button class="button left" onclick="moveLeft()">&#10094;</button>
        <div class="carousel" id="carousel"></div>
        <button class="button right" onclick="moveRight()">&#10095;</button>
    </div>

    <!-- Include Bytescale Upload Widget script -->
    <script src="https://js.bytescale.com/upload-widget/v4"></script>
    
    <script>
		function getQueryParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }
		
        document.getElementById('uploadButton').onclick = function() {
            const options = {
				apiKey: "public_kW15c745sNfw4LfTwHbYJBYf93WK", // This is your API key.
				maxFileCount: 25,
				path: {
					folderPath: "/hochzeit",
				},
            };

            Bytescale.UploadWidget.open(options).then(
                files => {
                    const fileUrls = files.map(x => x.fileUrl).join("\n");
                    const success = fileUrls.length === 0
                        ? "No file selected."
                        : `File uploaded:\n\n${fileUrls}`;
                    alert(success);
                },
                error => {
                    alert(error);
                }
            );
        };
		
		async function listFolder(params) {  
			const baseUrl  = "https://api.bytescale.com";
			const path     = `/v2/accounts/${params.accountId}/folders/list`;
			const entries  = obj => Object.entries(obj).filter(([,val]) => (val ?? null) !== null);
			const query    = entries(params.querystring ?? {})
							 .flatMap(([k,v]) => Array.isArray(v) ? v.map(v2 => [k,v2]) : [[k,v]])
							 .map(kv => kv.join("=")).join("&");
			const response = await fetch(`${baseUrl}${path}${query.length > 0 ? "?" : ""}${query}`, {
				method: "GET",
				headers: Object.fromEntries(entries({
				  "Authorization": `Bearer ${params.apiKey}`,
				}))
			});
			
			const result = await response.json();
			if (Math.floor(response.status / 100) !== 2)
			throw new Error(`Bytescale API Error: ${JSON.stringify(result)}`);
			return result;
		}		
		
        const secretKey = getQueryParameter('k');
        const slideshowContainer = document.getElementById('slideshow-container');
        const carousel = document.getElementById('carousel');
        let offset = 0;

        async function createCarousel() {
            const images = await listFolder({
				accountId: "kW15c74",
				apiKey: `${secretKey}`,
				querystring: {
					folderPath: "/hochzeit",
					includeFiles: true,
				},
				showFinishButton: false,
			});
            images.items.forEach((image) => {
                const img = document.createElement('img');
                img.src = image.fileUrl;
                carousel.appendChild(img);
            });
        }

        function moveLeft() {
            const itemWidth = carousel.children[0].clientWidth + 10; // Bildbreite + Margin
            if (offset < 0) {
                offset += itemWidth;
                carousel.style.transform = `translateX(${offset}px)`;
            }
        }

        function moveRight() {
            const itemWidth = carousel.children[0].clientWidth + 10; // Bildbreite + Margin
            const maxOffset = -((carousel.children.length * itemWidth) - window.innerWidth);
            if (offset > maxOffset) {
                offset -= itemWidth;
                carousel.style.transform = `translateX(${offset}px)`;
            }
        }

        if (secretKey) {
            createCarousel();
        } else {
            console.log('Secret key is missing in the URL.');
        }
    </script>
	
	
</body>
</html>
